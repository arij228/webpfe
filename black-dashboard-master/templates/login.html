<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
</head>

<body>
  <div class="main">
    <input type="checkbox" id="chk" aria-hidden="true" 
           {% if just_registered or default_to_login or 'user_email' in session %}checked{% endif %}>

    <!-- Partie Sign up -->
    <div class="signup">
      <form id="signupForm" name="signupForm" method="POST" action="{{ url_for('signup') }}">
        <label for="chk" aria-hidden="true">Créer un compte</label>
        <!-- Message d'information pour les utilisateurs existants -->
        <div class="existing-account">
          <span>Déjà un compte?</span>
          <label for="chk" class="switch-form">Se connecter</label>
        </div>
        
        {% if signup_message %}
        <div class="message {% if 'envoyé' in signup_message|lower or 'success' in signup_message|lower %}success{% endif %}">
          {{ signup_message }}
        </div>
        {% endif %}
        
        <input type="email" name="email" placeholder="Email" required
          value="{{ request.form.email if request and request.form else '' }}">
        <input type="password" name="password" placeholder="Mot de passe" required>
        <button type="submit">Envoyer le code OTP</button>
      </form>

      <!-- OTP Verification Section -->
      <div id="otpSection" class="{% if show_otp %}visible{% else %}hidden{% endif %}">
        <form id="otpForm" method="POST" action="{{ url_for('verify_otp') }}">
          {% if otp_message %}
          <div class="message {% if otp_message and ('success' in otp_message|lower or 'réussi' in otp_message|lower) %}success{% endif %}">
            {{ otp_message }}
          </div>
          {% endif %}
          <p>Entrez le code OTP envoyé à {{ email_for_otp }}</p>
          <input type="hidden" name="email" value="{{ email_for_otp }}">
          <input type="text" name="otp" id="otpInput" placeholder="Entrez le code OTP" required>
          <button type="submit" id="verifyOtp">Vérifier OTP</button>
        </form>
      </div>
    </div>

    <!-- Partie Login -->
    <div class="login">
      <form id="loginForm" method="POST" action="{{ url_for('login') }}">
        <label for="chk" aria-hidden="true">Connexion</label>
        <!-- Option pour revenir à la création de compte -->
        <div class="new-account">
          <span>Pas encore de compte?</span>
          <label for="chk" class="switch-form">Créer un compte</label>
        </div>
        
        {% if login_message %}
        <div class="message {% if 'réussie' in login_message|lower or 'success' in login_message|lower %}success{% endif %}">
          {{ login_message }}
        </div>
        {% endif %}
        
        <input type="email" name="email" placeholder="Email" required
          value="{{ request.form.email if request and request.form else '' }}">
        <input type="password" name="password" placeholder="Mot de passe" required>
        <button type="submit">Se connecter</button>
      </form>
    </div>
  </div>
</body>

</html>